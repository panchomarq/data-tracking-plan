{% extends "base.html" %}

{% block title %}Dashboard - Data Tracking Plan{% endblock %}

{% block content %}
<div class="row mb-5 animate-fade-in">
    <div class="col-12 text-center text-lg-start">
        <h1 class="display-5 fw-bold text-dark mb-2">
            Overview
        </h1>
        <p class="lead text-muted">
            Monitor your tracking implementations across all platforms.
        </p>
    </div>
</div>

<div class="row g-4 animate-fade-in">
    {% for platform in platforms %}
    <div class="col-lg-6 col-xl-4">
        <div class="card h-100 border-0 shadow-sm hover-card">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-4">
                    <div class="d-flex align-items-center">
                        {% if 'Amplitude' in platform.platform %}
                            <div class="rounded-3 p-3 bg-primary-custom bg-opacity-10 me-3">
                                <i class="fas fa-chart-line fa-lg text-primary-custom"></i>
                            </div>
                        {% elif 'Insider' in platform.platform %}
                            <div class="rounded-3 p-3 bg-success-custom bg-opacity-10 me-3">
                                <i class="fas fa-users fa-lg text-success-custom"></i>
                            </div>
                        {% elif 'GTM' in platform.platform %}
                            <div class="rounded-3 p-3 bg-warning-custom bg-opacity-10 me-3">
                                <i class="fas fa-tags fa-lg text-warning-custom"></i>
                            </div>
                        {% endif %}
                        <div>
                            <h5 class="card-title fw-bold mb-1">{{ platform.platform }}</h5>
                            {% if platform.container_name %}
                                <span class="badge bg-light text-muted border">{{ platform.container_name }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="row g-3 mb-4">
                    {% if 'Amplitude' in platform.platform %}
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-light text-center h-100">
                                <h3 class="fw-bold mb-0">{{ platform.total_events }}</h3>
                                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Events</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-light text-center h-100">
                                <h3 class="fw-bold mb-0">{{ platform.unique_properties }}</h3>
                                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Properties</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-success-custom bg-opacity-10 text-center h-100">
                                <h3 class="fw-bold mb-0 text-success-custom">{{ platform.active_events }}</h3>
                                <small class="text-success-custom text-uppercase fw-bold" style="font-size: 0.7rem;">Active</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-danger bg-opacity-10 text-center h-100">
                                <h3 class="fw-bold mb-0 text-danger">{{ platform.deleted_events }}</h3>
                                <small class="text-danger text-uppercase fw-bold" style="font-size: 0.7rem;">Deleted</small>
                            </div>
                        </div>
                    {% elif 'Insider' in platform.platform %}
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-light text-center h-100">
                                <h3 class="fw-bold mb-0">{{ platform.total_events }}</h3>
                                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Events</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-light text-center h-100">
                                <h3 class="fw-bold mb-0">{{ platform.unique_properties }}</h3>
                                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Params</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-info bg-opacity-10 text-center h-100">
                                <h3 class="fw-bold mb-0 text-info">{{ platform.custom_params }}</h3>
                                <small class="text-info text-uppercase fw-bold" style="font-size: 0.7rem;">Custom</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-success-custom bg-opacity-10 text-center h-100">
                                <h3 class="fw-bold mb-0 text-success-custom">{{ platform.native_params }}</h3>
                                <small class="text-success-custom text-uppercase fw-bold" style="font-size: 0.7rem;">Native</small>
                            </div>
                        </div>
                    {% elif 'GTM' in platform.platform %}
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-light text-center h-100">
                                <h3 class="fw-bold mb-0">{{ platform.total_tags }}</h3>
                                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Tags</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-light text-center h-100">
                                <h3 class="fw-bold mb-0">{{ platform.total_variables }}</h3>
                                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Vars</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-success-custom bg-opacity-10 text-center h-100">
                                <h3 class="fw-bold mb-0 text-success-custom">{{ platform.active_tags }}</h3>
                                <small class="text-success-custom text-uppercase fw-bold" style="font-size: 0.7rem;">Active</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3 bg-info bg-opacity-10 text-center h-100">
                                <h3 class="fw-bold mb-0 text-info">{{ platform.total_destinations }}</h3>
                                <small class="text-info text-uppercase fw-bold" style="font-size: 0.7rem;">Destinations</small>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <div class="d-grid">
                    {% if 'Amplitude' in platform.platform %}
                        <a href="{{ url_for('web.amplitude_detail') }}" class="btn btn-primary">
                            View Analytics <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    {% elif 'Insider' in platform.platform %}
                        <a href="{{ url_for('web.insider_detail') }}" class="btn btn-success text-white">
                            View Analytics <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    {% elif 'GTM' in platform.platform %}
                        {% if 'server-side' in platform.platform %}
                            <a href="{{ url_for('web.gtm_detail', container_type='server') }}" class="btn btn-warning text-white">
                                View Details <i class="fas fa-arrow-right ms-2"></i>
                            </a>
                        {% else %}
                            <a href="{{ url_for('web.gtm_detail', container_type='client') }}" class="btn btn-warning text-white">
                                View Details <i class="fas fa-arrow-right ms-2"></i>
                            </a>
                        {% endif %}
                    {% endif %}
                </div>

                {% if platform.last_updated %}
                <div class="mt-3 text-center">
                    <small class="text-muted">
                        <i class="far fa-clock me-1"></i> Updated {{ platform.last_updated }}
                    </small>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if not platforms %}
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-warning d-flex align-items-center shadow-sm" role="alert">
            <i class="fas fa-exclamation-triangle fa-lg me-3"></i>
            <div>
                <strong>No data sources found.</strong> 
                <p class="mb-0">Please check that your data files are properly configured in the <code>sources/</code> directory.</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Summary Statistics -->
{% if platforms %}
<div class="row mt-5 mb-4 animate-fade-in">
    <div class="col-12">
        <h3 class="fw-bold text-dark">Global Statistics</h3>
    </div>
</div>
<div class="row g-4 animate-fade-in">
    <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm bg-primary-custom text-white h-100">
            <div class="card-body text-center p-4">
                <div class="mb-3 opacity-75">
                    <i class="fas fa-layer-group fa-2x"></i>
                </div>
                <h2 class="fw-bold mb-1">{{ platforms | selectattr('total_events') | map(attribute='total_events') | sum }}</h2>
                <p class="mb-0 opacity-75 font-monospace">Total Events</p>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm bg-success-custom text-white h-100">
            <div class="card-body text-center p-4">
                <div class="mb-3 opacity-75">
                    <i class="fas fa-code fa-2x"></i>
                </div>
                <h2 class="fw-bold mb-1">{{ platforms | selectattr('total_properties') | map(attribute='total_properties') | sum or platforms | selectattr('unique_properties') | map(attribute='unique_properties') | sum }}</h2>
                <p class="mb-0 opacity-75 font-monospace">Total Properties</p>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm bg-warning-custom text-white h-100">
            <div class="card-body text-center p-4">
                <div class="mb-3 opacity-75">
                    <i class="fas fa-tag fa-2x"></i>
                </div>
                <h2 class="fw-bold mb-1">{{ platforms | selectattr('total_tags') | map(attribute='total_tags') | sum }}</h2>
                <p class="mb-0 opacity-75 font-monospace">Total Tags</p>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm bg-dark text-white h-100">
            <div class="card-body text-center p-4">
                <div class="mb-3 opacity-75">
                    <i class="fas fa-server fa-2x"></i>
                </div>
                <h2 class="fw-bold mb-1">{{ platforms | length }}</h2>
                <p class="mb-0 opacity-75 font-monospace">Platforms</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-lg-8 mb-4">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body p-4">
                <h5 class="card-title fw-bold mb-4">Platform Comparison</h5>
                <div id="platform-comparison-chart" style="width: 100%; height: 400px;"></div>
            </div>
        </div>
    </div>
    <!-- Add more widgets here if needed -->
</div>
{% endif %}
{% endblock %}
